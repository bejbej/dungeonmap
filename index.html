<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" type="text/css" href="styles/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="styles/app.css">
    <link rel="stylesheet" type="text/css" href="styles/toolbar.css">
    <link rel="stylesheet" type="text/css" href="styles/menu.css">
    <link rel="stylesheet" type="text/css" href="styles/canvas.css">
</head>

<body>
    <div id=menu class=hidden>
        <button id=hide-menu><i class="fa fa-arrow-left"></i> Back</button>
        <button id=new><i class="fa fa-file-o"></i> New</button>
        <hr>
        <div class=properties>
            <label>Image URL</label><br>
            <input id=image-url /><br>
        </div>
    </div>
    <div id=toolbar class=toolbar>
        <button id=show-menu>
            <i class="fa fa-cog"></i>
            <div class=tooltip>Menu</div>
        </button>
        <div class=button-group>
            <button id=select>
                <i class="fa fa-arrows"></i>
                <div class=tooltip>Select</div>
            </button>
            <button id=draw>
                <i class="fa fa-pencil"></i>
                <div class=tooltip>Draw</div>
            </button>
            <button id=view>
                <i class="fa fa-eye"></i>
                <div class=tooltip>View</div>
            </button>
        </div>
    </div>
    <div class=line-height-none>
        <div class=spacer-height></div><br>
        <div class=spacer-width></div><div id="canvas" class=canvas>
            <img id=img />
            <svg id=svg></svg>
        </div><div class=spacer-width></div><br>
        <div class=spacer-height></div>    
    </div>
</body>
<script src="scripts/file.js"></script>
<script src="scripts/canvas.js"></script>
<script src="scripts/tool-manager.js"></script>
<script src="scripts/draw-tool.js"></script>
<script src="scripts/delete-tool.js"></script>
<script src="scripts/move-tool.js"></script>
<script src="scripts/resize-tool.js"></script>
<script src="scripts/select-tool.js"></script>
<script src="scripts/toolbar.js"></script>
<script src="scripts/menu.js"></script>
<script>
    var file = new File();
    var canvas = new Canvas(document.getElementById("canvas"));
    var toolbar = new Toolbar(document.getElementById("toolbar"));
    var menu = new Menu(document.getElementById("menu"));
    var toolmanager = new ToolManager(document.getElementById("canvas"));

    // Load initial data
    var data = file.loadFromHash();
    if (data) {
        canvas.setImageUrl(data.imageUrl);
        canvas.setShapes(data.shapes);
    }

    toolbar.on("select", () => {
        toolmanager.setTools([SelectTool, MoveTool, ResizeTool, DeleteTool]);
    });
    toolbar.on("draw", () => toolmanager.setTools([DrawRectangleTool]));

    /*
    // Set up event listeners
    toolbar.on("show-menu", () => menu.show());
    toolbar.on("select", () => canvas.startSelecting());
    toolbar.on("draw", () => canvas.startDrawing());
    toolbar.on("view", () => canvas.startViewing());

    menu.on("new", () => {
        menu.hide();
        canvas.setImageUrl("");
        canvas.setShapes([]);
    });

    menu.on("image-url", () => {
        canvas.setImageUrl(menu.getImageUrl());
    });

    canvas.on("shapes", () => {
        file.saveToHash(canvas.getData());
    });

    canvas.on("load", () => {
        window.setTimeout(() => window.scroll(0.9 * window.innerWidth - 60, 0.9 * window.innerHeight - 60), 0);
    });

    window.onhashchange = () => {
        var data = file.loadFromHash();
        if (data) {
            canvas.setImageUrl(data.imageUrl);
            canvas.setShapes(data.shapes);
        }
        menu.hide();
        toolbar.reset();
    }

    // Initialize the app
    toolbar.reset();
    */
    if (data === null) {
        location.hash = "2\\./images/map.png\\/\\k\\2D\\1y\\37\\2f\\3O\\1A\\1x\\2d\\2E\\1O\\19\\3y\\2R\\10\\n\\4T\\16\\2M\\1O\\46\\3A\\1E\\1n";
    }

</script>
<script>

</script>
</html>