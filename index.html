<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" type="text/css" href="styles/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="styles/app.css">
    <link rel="stylesheet" type="text/css" href="styles/toolbar.css">
    <link rel="stylesheet" type="text/css" href="styles/menu.css">
    <link rel="stylesheet" type="text/css" href="styles/canvas.css">
</head>

<body>
    <div id=menu class=hidden>
        <button id=hide-menu><i class="fa fa-arrow-left"></i> Back</button>
        <button id=new><i class="fa fa-file-o"></i> New</button>
        <hr>
        <div class=properties>
            <label>Image URL</label><br>
            <input id=image-url /><br>
        </div>
    </div>
    <div id=toolbar class=toolbar>
        <button id=show-menu>
            <i class="fa fa-cog"></i>
            <div class=tooltip>Menu</div>
        </button>
        <div class=button-group>
            <button id=select>
                <i class="fa fa-arrows"></i>
                <div class=tooltip>Select</div>
            </button>
            <button id=draw>
                <i class="fa fa-pencil"></i>
                <div class=tooltip>Draw</div>
            </button>
            <button id=view>
                <i class="fa fa-eye"></i>
                <div class=tooltip>View</div>
            </button>
        </div>
    </div>
    <div id="canvas" class=canvas>
        <img id=img />
        <svg id=svg></svg>
    </div>
</body>
<script src="scripts/file.js"></script>
<script src="scripts/canvas.js"></script>
<script src="scripts/toolbar.js"></script>
<script src="scripts/menu.js"></script>
<script>
    var file = new File();
    var canvas = new Canvas(document.getElementById("canvas"));
    var toolbar = new Toolbar(document.getElementById("toolbar"));
    var menu = new Menu(document.getElementById("menu"));

    // Load initial data
    var data = file.loadFromHash();
    canvas.setImageUrl(data.imageUrl);
    canvas.setShapes(data.shapes);

    // Set up event listeners
    toolbar.on("show-menu", () => menu.show());
    toolbar.on("select", () => canvas.startSelecting());
    toolbar.on("draw", () => canvas.startDrawing());
    toolbar.on("view", () => canvas.startViewing());

    menu.on("new", () => {
        menu.hide();
        canvas.setImageUrl("");
        canvas.setShapes([]);
    });

    menu.on("image-url", () => {
        canvas.setImageUrl(menu.getImageUrl());
    });

    canvas.on("shapes", () => {
        file.saveToHash(canvas.getData());
    });

    window.onhashchange = () => {
        var data = file.loadFromHash();
        canvas.setImageUrl(data.imageUrl);
        canvas.setShapes(data.shapes);
        menu.close();
        toolbar.reset();
    }

    toolbar.reset();
</script>
</html>